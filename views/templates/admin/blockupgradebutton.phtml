<?php
/**
 * 2007-2016 PrestaShop
 *
 * Thirty Bees is an extension to the PrestaShop e-commerce software developed by PrestaShop SA
 * Copyright (C) 2017 Thirty Bees
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@thirtybees.com so we can send you a copy immediately.
 *
 * @author    Thirty Bees <modules@thirtybees.com>
 * @author    PrestaShop SA <contact@prestashop.com>
 * @copyright 2017 Thirty Bees
 * @copyright 2007-2016 PrestaShop SA
 * @license   http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 * PrestaShop is an internationally registered trademark & property of PrestaShop SA
 */

/** @var AdminThirtyBeesMigrateController $this */
$channel = $this->getConfig('channel');
?>

<div id="upgradeButtonBlock" class="panel col-lg-12">
	<div class="panel-heading"><i class="icon icon-wrench"></i> <?php echo $this->l('Start your Upgrade'); ?></div>
	<div class="blocOneClickUpgrade">
		<strong><?php echo $this->l('Your current PrestaShop version'); ?>:</strong>
		<code><?php echo _PS_VERSION_; ?></code>
		<?php if (version_compare(_PS_VERSION_, '1.6.0.0', '>=') && version_compare(_PS_VERSION_, '1.7.0.0', '<')) : ?>
			<p><?php echo $this->l('This version can be migrated to thirty bees'); ?></p>
		<?php endif; ?>
	</div>

    <?php if ($this->configOk()) : ?>
        <?php $showBigButtonNewVersion = false; ?>
        <?php if (count(\PsOneSixMigrator\AjaxProcessor::$skipAction) > 0) : ?>
			<div id="skipAction-list" class="alert alert-warning">
                <?php echo $this->l('The following action are automatically replaced'); ?>
				<ul>
                    <?php foreach (\PsOneSixMigrator\AjaxProcessor::$skipAction as $k => $v) : ?>
						<li><?php echo sprintf($this->l('%1$s will be replaced by %2$s'), '<b>'.$k.'</b>', '<b>'.$v.'</b>'); ?></li>
                    <?php endforeach; ?>
				</ul>
				<p><?php echo $this->l('To change this behavior, you need to manually edit your php files'); ?></p>
			</div>
        <?php else : ?>
            <?php $showBigButtonNewVersion = true; ?>
        <?php endif; ?>
        <?php if ($this->configOk()) : ?>
			<strong><?php echo $this->l('Are you ready for thirty bees?'); ?></strong>
			<p class="clearfix">
				<a href="" id="upgradeNow" class="upgradestep btn btn-primary btn-lg">
					<i class="icon icon-wrench"></i> <?php echo sprintf($this->l('Migrate to thirty bees'), $this->upgrader->versionNum); ?>
				</a>
			</p>
			<div class="clearfix"></div>
			<a class="btn btn-default" href="<?php echo AdminThirtyBeesMigrateController::$currentIndex; ?>&token=<?php echo $this->token; ?>&refreshCurrentVersion=1">
				<i class="icon icon-refresh"></i> <?php echo $this->l('refresh the page'); ?>
			</a>
			<div>
				<span><?php echo sprintf($this->l('Last check: %s'), date('Y-m-d H:i:s', \Configuration::get('PS_LAST_VERSION_CHECK'))); ?></span>
			</div>
        <?php endif; ?>
        <?php echo $this->getBlockConfigurationAdvanced(); ?>
    <?php endif; ?>
</div>

<?php if ($this->manualMode) : ?>
    <?php echo $this->displayDevTools(); ?>
<?php endif; ?>
